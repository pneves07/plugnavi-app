"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6260],{6260:(j,p,c)=>{c.r(p),c.d(p,{HomePageModule:()=>v});var u=c(6814),d=c(95),i=c(3582),m=c(1379),g=c(5861),_=c(7838),t=c(9468),h=c(9862);const f=["stepsModal"];function P(n,r){if(1&n){const s=t.EpF();t.TgZ(0,"ion-item",15),t.NdJ("click",function(){const a=t.CHM(s).$implicit,l=t.oxw(3);return t.KtG(l.selecionarSugestao(a))}),t._uU(1),t.qZA()}if(2&n){const s=r.$implicit;t.xp6(1),t.hij(" ",s.place_name," ")}}function M(n,r){if(1&n&&(t.TgZ(0,"ion-list"),t.YNc(1,P,2,1,"ion-item",14),t.qZA()),2&n){const s=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",s.sugestoes)}}function x(n,r){if(1&n){const s=t.EpF();t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",11),t.NdJ("click",function(){t.CHM(s);const e=t.oxw();return t.KtG(e.closeModal())}),t._uU(4,"Fechar"),t.qZA()(),t.TgZ(5,"ion-title"),t._uU(6,"Pesquisar"),t.qZA()()(),t.TgZ(7,"ion-content",6)(8,"ion-searchbar",12),t.NdJ("ngModelChange",function(e){t.CHM(s);const a=t.oxw();return t.KtG(a.enderecoPesquisa=e)})("ionInput",function(){t.CHM(s);const e=t.oxw();return t.KtG(e.buscarSugestoes())}),t.qZA(),t.YNc(9,M,2,1,"ion-list",13),t.qZA()}if(2&n){const s=t.oxw();t.xp6(8),t.Q6J("ngModel",s.enderecoPesquisa),t.xp6(1),t.Q6J("ngIf",s.sugestoes.length>0)}}function y(n,r){if(1&n){const s=t.EpF();t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",11),t.NdJ("click",function(){t.CHM(s);const e=t.oxw();return t.KtG(e.closeModal2())}),t._uU(4,"Fechar"),t.qZA()(),t.TgZ(5,"ion-title"),t._uU(6,"Postos"),t.qZA()()(),t.TgZ(7,"ion-content",6),t._uU(8," Posto 1 "),t.qZA()}}function Z(n,r){if(1&n){const s=t.EpF();t.TgZ(0,"ion-card",16)(1,"ion-card-header")(2,"ion-card-title"),t._uU(3),t.qZA(),t.TgZ(4,"ion-card-subtitle"),t._uU(5),t.qZA()(),t.TgZ(6,"ion-button",17),t.NdJ("click",function(){t.CHM(s);const e=t.oxw();return t.KtG(e.openSteps())}),t._uU(7,"Ver Passos"),t.qZA()()}if(2&n){const s=t.oxw();t.xp6(3),t.Oqu(s.enderecoPesquisa),t.xp6(2),t.AsE("",s.distance," \u2022 ",s.duration,"")}}function b(n,r){if(1&n&&(t.TgZ(0,"ion-item")(1,"ion-note",0),t._uU(2),t.qZA(),t.TgZ(3,"ion-label",19)(4,"ion-note",20),t._uU(5),t.qZA()(),t.TgZ(6,"ion-note",1),t._uU(7),t.qZA()()),2&n){const s=r.$implicit,o=t.oxw(2);t.xp6(2),t.hij(" ",o.formatDistance(s.distance)," "),t.xp6(3),t.hij(" ",s.maneuver.instruction," "),t.xp6(2),t.hij(" ",o.secondsToHms(s.duration)," ")}}function T(n,r){if(1&n&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),t._uU(3,"Passos"),t.qZA()()(),t.TgZ(4,"ion-content"),t.YNc(5,b,8,3,"ion-item",18),t.qZA()),2&n){const s=t.oxw();t.xp6(5),t.Q6J("ngForOf",s.steps)}}const H=function(){return[0,.5,.99]},C=[{path:"",component:(()=>{var n;class r{closeModal(){this.modalPesquisa.dismiss()}closeModal2(){this.modalPostos.dismiss()}constructor(o){var e=this;this.http=o,this.openModal=!1,this.start=[],this.end=[],this.route=1,this.routeLoaded=!1,this.distance="",this.duration="",this.steps=[],this.enderecoPesquisa="",this.sugestoes=[],this.accessToken="pk.eyJ1IjoiYXBwbGRzMjAyMyIsImEiOiJjbG54ZHN0eGUwZXhqMnJsZWQwdjQ2eGo3In0.sjYUyiQqmHivuVPw14GH5g",this.loadMap=(0,g.Z)(function*(){e.coordenadas=yield _.b.getCurrentPosition(),mapboxgl.accessToken=e.accessToken,e.map=new mapboxgl.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[e.coordenadas.coords.longitude,e.coordenadas.coords.latitude],zoom:15}),e.start=[e.coordenadas.coords.longitude,e.coordenadas.coords.latitude],e.map.on("load",()=>{e.getRoute(e.start),e.map.addLayer({id:"point",type:"circle",source:{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Point",coordinates:e.start}}]}},paint:{"circle-radius":5,"circle-color":"#3880ff","circle-stroke-color":"white","circle-stroke-width":2}})})})}ngOnInit(){}ionViewDidEnter(){this.loadMap()}getLocation(o){var e=this;return(0,g.Z)(function*(){mapboxgl.accessToken="pk.eyJ1IjoiYXBwbGRzMjAyMyIsImEiOiJjbG54ZHN0eGUwZXhqMnJsZWQwdjQ2eGo3In0.sjYUyiQqmHivuVPw14GH5g";const a=yield fetch(`GET: https://api.mapbox.com/geocoding/v5/mapbox.places/${o}.json?country=pt&proximity=ip&language=pt&access_token=${mapboxgl.accessToken}`,{method:"GET"});e.routeData=yield a.json(),console.log(e.routeData),e.drawRoute()})()}buscarSugestoes(){this.enderecoPesquisa?this.http.get(`https://api.mapbox.com/geocoding/v5/mapbox.places/${this.enderecoPesquisa}.json?access_token=${this.accessToken}&autocomplete=true&limit=5&country=PT`).subscribe(e=>{this.sugestoes=e.features},e=>{console.error(e),this.sugestoes=[]}):this.sugestoes=[]}selecionarSugestao(o){this.enderecoPesquisa=o.place_name,this.sugestoes=[],this.getRoute([o.geometry.coordinates[0],o.geometry.coordinates[1]]),this.modalPesquisa.dismiss()}pesquisarEndereco(){this.http.get(`https://api.mapbox.com/geocoding/v5/mapbox.places/${this.enderecoPesquisa}.json?access_token=${this.accessToken}`).subscribe(e=>{this.getRoute(e.features[0].geometry.coordinates)})}getRoute(o){var e=this;return(0,g.Z)(function*(){mapboxgl.accessToken="pk.eyJ1IjoiYXBwbGRzMjAyMyIsImEiOiJjbG54ZHN0eGUwZXhqMnJsZWQwdjQ2eGo3In0.sjYUyiQqmHivuVPw14GH5g";const a=yield fetch(`https://api.mapbox.com/directions/v5/mapbox/driving/${e.start[0]},${e.start[1]};${o[0]},${o[1]}?steps=true&alternatives=true&annotations=distance%2Cduration%2Cspeed%2Cclosure&geometries=geojson&language=pt&access_token=${mapboxgl.accessToken}`,{method:"GET"});e.routeData=yield a.json(),console.log(e.routeData),e.drawRoute()})()}drawRoute(){const e={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:1==this.route?this.routeData.routes[0].geometry.coordinates:this.routeData.routes[1].geometry.coordinates}};this.map.getSource("route")?this.map.getSource("route").setData(e):this.map.addLayer({id:"route",type:"line",source:{type:"geojson",data:e},layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#3880ff","line-width":3,"line-opacity":.75}}),1==this.route?(this.steps=this.routeData.routes[0].legs[0].steps,this.duration=this.secondsToHms(this.routeData.routes[0].duration),this.distance=this.formatDistance(this.routeData.routes[0].distance)):(this.steps=this.routeData.routes[1].legs[0].steps,this.duration=this.secondsToHms(this.routeData.routes[1].duration),this.distance=this.formatDistance(this.routeData.routes[1].distance)),this.routeLoaded=!0}secondsToHms(o){o=Number(o);var e=Math.floor(o/3600),a=Math.floor(o%3600/60),l=Math.floor(o%3600%60);return(e>0?e+" h, ":"")+(a>0?a+" m, ":"")+(l>0?l+" s":"")}formatDistance(o){return(o/1e3).toFixed(2)+" km"}changeRoute(o){this.route=o,this.drawRoute()}openSteps(){this.openModal=!0,this.stepsModal.onWillDismiss().then(()=>{this.openModal=!1})}}return(n=r).\u0275fac=function(o){return new(o||n)(t.Y36(h.eN))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-home"]],viewQuery:function(o,e){if(1&o&&(t.Gf(i.ki,5),t.Gf(i.ki,5),t.Gf(f,5)),2&o){let a;t.iGM(a=t.CRH())&&(e.modalPesquisa=a.first),t.iGM(a=t.CRH())&&(e.modalPostos=a.first),t.iGM(a=t.CRH())&&(e.stepsModal=a.first)}},decls:19,vars:5,consts:[["slot","start"],["slot","end"],["id","modalPesquisa"],["name","search-outline"],["trigger","modalPesquisa"],["trigger","modalPostos"],[1,"ion-padding"],["id","map"],["style","margin-top: 2%;",4,"ngIf"],[3,"isOpen","breakpoints","initialBreakpoint"],["stepsModal",""],[3,"click"],["animated","true","placeholder","Pesquisar",3,"ngModel","ngModelChange","ionInput"],[4,"ngIf"],["button","",3,"click",4,"ngFor","ngForOf"],["button","",3,"click"],[2,"margin-top","2%"],["fill","clear",3,"click"],[4,"ngFor","ngForOf"],[1,"ion-text-wrap"],[2,"font-size","12px"]],template:function(o,e){1&o&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-menu-button"),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5," Mapa "),t.qZA(),t.TgZ(6,"ion-buttons",1)(7,"ion-button",2),t._UZ(8,"ion-icon",3),t.qZA()()()(),t.TgZ(9,"ion-modal",4),t.YNc(10,x,10,2,"ng-template"),t.qZA(),t.TgZ(11,"ion-modal",5),t.YNc(12,y,9,0,"ng-template"),t.qZA(),t.TgZ(13,"ion-content",6),t._UZ(14,"div",7),t.YNc(15,Z,8,3,"ion-card",8),t.TgZ(16,"ion-modal",9,10),t.YNc(18,T,6,1,"ng-template"),t.qZA()()),2&o&&(t.xp6(15),t.Q6J("ngIf",e.enderecoPesquisa),t.xp6(1),t.Q6J("isOpen",e.openModal)("breakpoints",t.DdM(4,H))("initialBreakpoint",.5))},dependencies:[u.sg,u.O5,d.JJ,d.On,i.YG,i.Sm,i.PM,i.Zi,i.tO,i.Dq,i.W2,i.Gu,i.gu,i.Ie,i.Q$,i.q_,i.fG,i.uN,i.VI,i.wd,i.sr,i.ki,i.j9],styles:["#map[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%}ion-modal[_ngcontent-%COMP%]{--border-radius: 10px 10px 0 0}.travelModes[_ngcontent-%COMP%]{position:fixed;background-color:#fff;z-index:1;border-radius:100px}.travelModes[_ngcontent-%COMP%]   ion-buttons[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{font-size:12px}.footer[_ngcontent-%COMP%]{position:fixed;bottom:35px;background:#ffffff;border-radius:100px;width:90%;left:50%;transform:translate(-50%)}.footer[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{height:35px;display:flex;align-items:center;justify-content:center}.footer[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]   ion-note[_ngcontent-%COMP%], .footer[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{font-size:12px}.footer[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]   .routes[_ngcontent-%COMP%]{display:inline;background:var(--ion-color-light);padding:3px 10px;border-radius:100px;color:var(--ion-color-medium)}.footer[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]   .routes[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]{color:var(--ion-color-primary)}"]}),r})()}];let q=(()=>{var n;class r{}return(n=r).\u0275fac=function(o){return new(o||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[m.Bz.forChild(C),m.Bz]}),r})(),v=(()=>{var n;class r{}return(n=r).\u0275fac=function(o){return new(o||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[u.ez,d.u5,i.Pc,q]}),r})()}}]);